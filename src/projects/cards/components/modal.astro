---
interface Props {
	id: string;
	labelledby: string;
	role?: string;
	width?: string;
}

const { id, labelledby, role, width } = Astro.props;
const style = width ? `--modal-width: ${width}` : undefined;
---

<dialog class="modal" id={id} role={role} aria-labelledby={labelledby} style={style}>
	<div class="modal__content">
		<slot />
	</div>
</dialog>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		document.querySelectorAll<HTMLDialogElement>('.modal').forEach((dialog) => {
			dialog.addEventListener('click', (e) => {
				if (e.target === dialog) dialog.close();
			});
		});
	});
</script>

<style>
	.modal {
		border: none;
		border-radius: 1rem;
		padding: 0;
		max-width: 90vw;
		width: var(--modal-width, 24rem);
		background: var(--color-surface, #fff);
		box-shadow: 0 1rem 3rem rgba(0, 0, 0, 0.3);
	}

	.modal::backdrop {
		background: rgba(0, 0, 0, 0.6);
		backdrop-filter: blur(4px);
	}

	.modal__content {
		padding: 2rem;
	}

	@media (prefers-reduced-motion: no-preference) {
		.modal[open] {
			animation: modal-appear 0.3s ease-out;
		}

		.modal[open]::backdrop {
			animation: modal-backdrop-appear 0.3s ease-out;
		}
	}

	@keyframes modal-appear {
		from {
			opacity: 0;
			transform: scale(0.9) translateY(-1rem);
		}
		to {
			opacity: 1;
			transform: scale(1) translateY(0);
		}
	}

	@keyframes modal-backdrop-appear {
		from {
			opacity: 0;
		}
		to {
			opacity: 1;
		}
	}
</style>
