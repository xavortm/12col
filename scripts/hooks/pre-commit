#!/bin/sh

# Pre-commit hook for checking documentation consistency
# This hook runs automatically before each git commit

# Get list of staged files
STAGED_FILES=$(git diff --cached --name-only)

# Check if any files that might affect documentation are being committed
SHOULD_CHECK=0

# Check for relevant file changes
echo "$STAGED_FILES" | grep -qE "(package\.json|src/projects/|CLAUDE\.md|README\.md|astro\.config)"
if [ $? -eq 0 ]; then
  SHOULD_CHECK=1
fi

# If no relevant files changed, skip the check
if [ $SHOULD_CHECK -eq 0 ]; then
  exit 0
fi

# Run the documentation checker
node scripts/check-docs.mjs

# Capture exit code
EXIT_CODE=$?

# If the check failed, prevent commit (unless --no-verify is used)
if [ $EXIT_CODE -ne 0 ]; then
  exit 1
fi

exit 0
